# ノードバックアップとリストア

ノードが稼働した後、災害復旧に備える時が来ました。ハードウェアやソフトウェアの問題、あるいは自然災害でさえ、お使いのマシンが壊滅的な障害を発生した場合、バックアップを作成することによりそのような状況に備えたほうがよいでしょう。

実行時、データベースとともに完全なノードインストールが、複数のギガバイトにできるようにすることができます。このような大量のデータをバックアップ、復元しなければならない場合、高価で複雑かつ時間のかかる可能性があります。幸いなことに、より良い方法があります。

すべてをバックアップし、復元する必要がなくなります。Avalanchegoノードとして、ユニークファイルは、ネットワーク上のノードを識別するもので、つまり、あなたのNodeIDを定義するファイルです。インストール自体が、新しいマシンにインストールすることで簡単に再現できます。そして、残りのギガバイト数のブロックチェーンデータは、ブートストラップのプロセスにより簡単に再現できます。これにより、他のネットワークピーアからデータをコピーすることができます。

あなたのノードがネットワーク上のバリデータであり、その上に複数のデリゲーションを持っているとしても、バリデーションとデリゲーションがブートストラップ中に保存され、ブートストラップ中にリストアされるため、他のブートデータがバックアップする必要はありません。

## NodeID

NodeIDは、ネットワーク上の他のすべてのピアと区別するユニークな識別子です。まさに `NodeID-5mb46qkSBj81k9g9e4VFjGGSbaaSLFRzD`.[ここに](../../references/cryptographic-primitives.md#tls-addresses)NodeIDがどのように構築されるかについて、技術的な背景を見ることができます。つまり、NodeIDは、2つのファイルで定義されます：

* `staker.crt`
* `staker.key`

`~/.avalanchego/staking/`デフォルトのインストールでは、ワーキングディレクトリ内に、特に .別のマシン上でノードを再作成するために必要なことは、同じ2つのファイルで新しいインストールを実行するだけです。

{% hint style="warning" %}ノードキーストアでユーザが定義されている場合、バックアップと復元する必要があります。[Keystore API](../../avalanchego-apis/keystore-api.md)には、ユーザーキーをエクスポート、インポートできるメソッドがあります。Keystore APIは、開発者によってのみ使用され、本番のノードで使用されることを意図するものではありません。鍵ストアAPIが何かがわからない、使用されていない場合、心配する必要はありません。{% endhint %}

## バックアップ

ノードをバックアップするには、安全かつプライベートな場所に`staker.key`ファイルを保存し、クラウドやUSBスティックあるいは同様のプライベートストレージに保存`staker.crt`する必要があります。異なる安全な場所に保存することにより、安全性の高いものが安全になります。

{% hint style="warning" %}誰かがステーカーファイルの保持を取得した場合、ノードではなくウォレット秘密鍵でコントロールされるため、資金にアクセスすることはできません。しかし、他の場所に戻すことができ、状況によってはステーキング報酬が失われるようになります。したがって、ステーカーファイルが安全であることを確認します。{% endhint %}

ノードを実行するマシンからステーカーファイルを取得しましょう。

### ローカルノードから

デスクトップコンピュータ上でローカルでノードを実行している場合、ファイルがどこにいるかに移動し、安全な場所にコピーするだけです。

`USERNAME`デフォルトのLinuxインストールでは、彼らへのパスが下ります`/home/USERNAME/.avalanchego/staking/`。そこからバックアップ場所にファイルを選択、コピーします。そのため、ノードを停止する必要はありません。

### リモートノードから`scp`

`scp`は、LinuxとMacOSコンピュータ上で組み込み可能な「安全なコピー」コマンドラインプログラムです。`pscp`[PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)パッケージの一部として、Windowsバージョンもあります。以下のコマンドで使用する場合`pscp`、それぞれの使用法を`scp`置き換える。`pscp -scp`

ノードからファイルをコピーするには、リモートでマシンにログインできる必要があります。アカウントパスワードですが、安全かつ推奨される方法として、SSH鍵を使用することです。SSH鍵を取得、セットアップするための手順は、クラウドプロバイダとマシン構成に大きく依存しています。これらのプロバイダーのための、[Amazon Webサービス](setting-up-an-avalanche-node-with-amazon-web-services-aws.md)と[Microsoft Azure](set-up-an-avalanche-node-with-microsoft-azure.md)セットアップガイドを参照することができます。他のプロバイダーは、同様の手続きがあります。

マシンにログインする手段があれば、以下のコマンドでファイルをコピーできます。

```text
scp -r ubuntu@PUBLICIP:/home/ubuntu/.avalanchego/staking ~/avalanche_backup
```

このことにより、マシン上のユーザー名は、異なる場合、両方の場所で正しいユーザー名に置き換えると想定`ubuntu`します。また、マシンの実際のパブリックIP`PUBLICIP`に置き換える。ダウンロードしたSSHキーを自動的に使用`scp`しない場合、手動で指摘することができます。

```text
scp -i /path/to/the/key.pem -r ubuntu@PUBLICIP:/home/ubuntu/.avalanchego/staking ~/avalanche_backup
```

実行後、このコマンドで、ホームディレクトリに`avalanche_backup`ディレクトリを作成し、ステーカーファイルを置くします。安全な場所に保存する必要があります。

## リストア

`staker.key``staker.crt`バックアップからノードを復元するには、逆の実行を行う必要があります。

まず、通常の[ノードインストール](set-up-node-with-installer.md)を行う必要があります。これにより新しいNodeIDが作成されます。ノードが正しくインストールされた場合、ノードが実行されているマシンにログインし、次のことを停止します。

```text
sudo systemctl stop avalanchego
```

ノードを復元する準備が完了しました。

### ローカルノードへ

`staker.key`ローカルでノードを実行している場合、バックアップ場所から`staker.crt`ファイルをコピーするだけです。`/home/USERNAME/.avalanchego/staking/`ノードを実行するために使用される実際のユーザー名`USERNAME`に置き換えます。

### を使用してリモートノードへ`scp`

繰り返しますが、このプロセスはただの逆オペレーションです。`scp`使用を使用する場合`staker.key`、バックアップ場所から`staker.crt`ファイルをリモートワークディレクトリにコピーする必要があります。バックアップファイルが、上記のバックアップ手続きが置かれたディレクトリに存在すると仮定します。

```text
scp ~/avalanche_backup/staker.* ubuntu@PUBLICIP:/home/ubuntu/.avalanchego/staking
```

あるいは、SSHキーへのパスを指定する必要がある場合：

```text
scp -i /path/to/the/key.pem ~/avalanche_backup/staker.* ubuntu@PUBLICIP:/home/ubuntu/.avalanchego/staking
```

`PUBLICIP`異なる場合、正しいユーザー`ubuntu`に置き換え、ノードを実行するマシンの実際のパブリックIP、使用される場合、SSHキーのパスで置き換えられます。

### ノードを再起動し、検証

ファイルが置き換えられた後、マシンにログインし、以下のようにノードを開始します。

```text
sudo systemctl start avalanchego
```

以前のコマンドを実行したと同じコンソールで[getNodeID](https://docs.avax.network/build/avalanchego-apis/info-api#info-getnodeid) APIコールを発行することで、正しいNodeIDでノードが復元されることを確認することができます。

```text
curl -X POST --data '{
    "jsonrpc":"2.0",
    "id"     :1,
    "method" :"info.getNodeID"
}' -H 'content-type:application/json;' 127.0.0.1:9650/ext/info
```

元のNodeIDが表示されるはずです。復元プロセスが完了しました。

## 概要

ノードを安全にする際に必須の部分は、完全かつ、手間のかからないノード復元を可能にするバックアップです。このチュートリアルの後で、あなたが一からあなたのノードが復元する必要がある状況で、あなたが簡単かつ迅速にそのようなことができ、そのことを知ることができます。

このチュートリアルを経由して問題が発生した場合、我々と共有したい、あるいはチャットしたいというコメントが発生した場合、[Discord](https://chat.avalabs.org/)サーバー上で私たちに連絡することができます。

