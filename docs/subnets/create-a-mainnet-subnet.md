# Create an EVM Subnet on Mainnet

After trying out a Subnet on `Fuji` using stored keys, by following [this tutorial](./create-a-fuji-subnet), next step is to try it out on `Mainnet`.

In this article, we show how to do the following on `Mainnet`.

- Create a Subnet.
- Deploy a virtual machine based on Subnet-EVM.
- Add a node as a validator to the Subnet.
- Join a node to the newly created Subnet.

All IDs in this article are for illustration purposes. They can be different in your own run-through of this tutorial.

## Prerequisites

- 1+ nodes running and fully bootstrapped on `Mainnet`. Check out the section [Nodes](../nodes/README.md) on how to run a node and become a validator.
- [`Avalanche-CLI`](https://github.com/ava-labs/avalanche-cli) installed
- a funded ledger device

### Virtual Machine

Avalanche can run multiple blockchains. Each blockchain is an instance of a [Virtual Machine (VM)](../subnets/README.md#virtual-machines), much like an object in an object-oriented language is an instance of a class.
That is, the VM defines the behavior of the blockchain.

[Subnet-EVM](https://github.com/ava-labs/subnet-evm) is the VM that defines the Subnet Contract Chains. Subnet-EVM is a simplified version of [Avalanche C-Chain](https://github.com/ava-labs/coreth).

This chain implements the Ethereum Virtual Machine and supports Solidity smart contracts as well as most other Ethereum client features.

### Mainnet

For this tutorial, we recommend that you follow [Run an Avalanche Node Manually](../nodes/build/run-avalanche-node-manually.md#start-a-node-and-connect-to-avalanche).

Also it is worth pointing out that [you need at least 2000 AVAX to become a validator on Mainnet](../nodes/validate/staking.md#mainnet).

To get the NodeID of this `Mainnet` node, call the following curl command [info.getNodeID](../apis/avalanchego/apis/info.md#infogetnodeid):

```text
curl -X POST --data '{
    "jsonrpc":"2.0",
    "id"     :1,
    "method" :"info.getNodeID"
}' -H 'content-type:application/json;' 127.0.0.1:9650/ext/info
```

The response should look something like:

```json
{
  "jsonrpc": "2.0",
  "result": {
    "nodeID": "NodeID-5mb46qkSBj81k9g9e4VFjGGSbaaSLFRzD"
  },
  "id": 1
}
```

That portion that says, `NodeID-5mb46qkSBj81k9g9e4VFjGGSbaaSLFRzD` is the NodeID, the entire thing. We is going to need this id in the later section when calling [addValidator](#add-a-validator).

:::info

It may take a while to bootstrap `Mainnet` from scratch. You can use [State-Sync](../nodes/maintain/chain-config-flags.md#state-sync-enabled-boolean) to shorten the time for bootstrapping.

:::

### Avalanche-CLI

If not yet installed, install `Avalanche-CLI` following the tutorial at [Avalanche-CLI installation](create-a-local-subnet.md#installation)

### Ledger

To support safest operations, locally stored keys are not enabled for `Mainnet` operations on CLI.

All commands which issue a transaction to `Mainnet` require usage of a connected ledger device, unlocked,
and with the Avalanche App running. See [How to use Ledger](https://support.avax.network/en/articles/6150237-how-to-use-a-ledger-nano-s-or-nano-x-with-avalanche) (up to and including point 4).

Supported ledger devices: `Nano X`, `Nano S`, `Nano S Plus`.

Ledger devices support TX signing for any address inside a sequence automatically generated by the device.

CLI is going to by default use the first address of such sequence, and for TX generation it needs to be funded
to support the fee of the deploy or add validator transaction (for multisig cases, only one of the used ledger addresses is going to 
be needed to be funded to support the fee, while the others not).

To get the first `Mainnet` address of your (connected, unblocked, avalanche app running) ledger device, execute
the `key list` command:

```bash
avalanche key list --ledger 0 --mainnet
```

The command first asks the user to authorize the ledger to give to the CLI extended public key information, which is needed
to generate the address list.

An authorization request is a common message in all CLI ops involving ledger:

```text
*** Please provide extended public key on the ledger device ***
```

On the ledger a `Provide Extended Public Key` window is going to be active. Navigate to the ledger `Accept` window by
using the ledger's right button, and then authorize the request by pressing both left and right buttons.

```text
+--------+---------+-------------------------+-----------------------------------------------+---------+---------+
|  KIND  |  NAME   |          CHAIN          |                    ADDRESS                    | BALANCE | NETWORK |
+--------+---------+-------------------------+-----------------------------------------------+---------+---------+
| ledger | index 0 | P-Chain (Bech32 format) | P-avax1ucykh6ls8thqpuwhg3vp8vvu6spg5e8tp8a25j |      11 | Mainnet |
+--------+---------+-------------------------+-----------------------------------------------+---------+---------+
```

The command prints the P-Chain address for `Mainnet`, `P-avax1ucykh6ls8thqpuwhg3vp8vvu6spg5e8tp8a25j` which is the one needed 
for this tutorial. Also prints the balance of the account, which, as said, should be enough to pay for the TX fee
(2 AVAX for deploy op, 0.001 AVAX for add Subnet validator op, see [Fees](../quickstart/transaction-fees))

Note the `key list` command can be used to get any ledger address in the sequence by changing the index parameter from `0` to the 
one desired, or to a list of them (for example: `2`, or `0,4,7`). Also you can ask for addresses to be used on `Fuji` with the `--fuji`
parameter, and local networks with the `--local` parameter.

#### Funding the Ledger

A new ledger device has no funds on the address controlled by it. Send funds via transfer to its correspondent addresses if you already have funds on a different address.

You need at least 2 AVAX for the deploy operation (Create Subnet + Create Blockchain, see [Fees](../quickstart/transaction-fees)).

You need at least 0.001 AVAX for the add validator operation.

## Create an EVM Subnet

Creating a Subnet with `Avalanche-CLI` for `Mainnet` is the same way as creating a one for `Fuji`. 

In fact, the `create` commands only creates a specification of your Subnet on the local file system. Afterwards the Subnet needs to be _deployed_. This allows to reuse configs, by creating the config with the `create` command, then first deploying to a local network and successively to `Fuji` or `Mainnet`.

See [this section](./create-a-fuji-subnet#create-an-evm-subnet)

## Deploy the Subnet

To deploy our new Subnet, we can run

```bash
avalanche subnet deploy testsubnet
```

Note: if the ledger is blocked, or the Avalanche Ledger App is not running, the command is going to end with error.

This is going to start a new prompt series.

```text
Use the arrow keys to navigate: ↓ ↑ → ←
? Choose a network to deploy on:
  ▸ Local Network
    Fuji
    Mainnet
```

This tutorial is about deploying to `Mainnet`, so we navigate with the arrow keys to `Mainnet` and hit enter.

We are then asked to authorize the ledger to provide extended public key information to CLI.

```text
✔ Mainnet
Deploying [testsubnet] to Mainnet
*** Please provide extended public key on the ledger device ***
```

On the ledger a `Provide Extended Public Key` window is going to be active. Navigate to the ledger `Accept` window by using
the ledger's right button, and then authorize the request by pressing both left and right buttons.

After that, the first `Mainnet` ledger address (which is going to be used to fund the deploy) is shown.

```text
Ledger address: P-avax1ucykh6ls8thqpuwhg3vp8vvu6spg5e8tp8a25j
```

The deployment consists in running a [createSubnet transaction](../apis/avalanchego/apis/p-chain.md#platformcreatesubnet) and a [createBlockchain transaction](../apis/avalanchego/apis/p-chain.md#platformcreateblockchain), and so this first ledger address 
must be funded to do the operation (funding described [here](#funding-the-ledger)).

Also, this tutorial assumes that a node is up and running, fully bootstrapped on `Mainnet`, and is being run from the **same** box.

Subnets are currently permissioned only. Therefore, the process now requires the user to tell _which addresses can control the Subnet_. We are prompted to use only the first ledger address (creation key), or a custom list of addresses.

```text
Configure which addresses may make changes to the subnet.
These addresses are known as your control keys. You is going to also
set how many control keys are required to make a subnet change (the threshold).
Use the arrow keys to navigate: ↓ ↑ → ← 
? How would you like to set your control keys?: 
  ▸ Use ledger address
    Custom list
```

For this tutorial, we opt for using the first ledger address, so enter at `Use ledger address`. Only this address is going to
be able to add or remove validators, or create blockchains on the Subnet.

```text
Your Subnet's control keys: [P-avax1ucykh6ls8thqpuwhg3vp8vvu6spg5e8tp8a25j]
Your subnet auth keys for chain creation: [P-avax1ucykh6ls8thqpuwhg3vp8vvu6spg5e8tp8a25j]
```

Currently, besides indicating a list of addresses that is going to be control keys, usually the user is required to
define the threshold of how many addresses are required for a change to be valid. In this case, as there is only
one control key, the threshold is forced to 1 without asking to the user, so that address and only that address
can authorize Subnet changes (auth keys for chain creation).
You is going to see more about this on [multisig deploy tutorial](./multisig-deploy).

Next, a TX for creating the Subnet id is generated and the user is asked to sign it by using the ledger.

```text
*** Please sign subnet creation hash on the ledger device *** 
```

On the ledger a `Sign Hash` window is going to be active. Navigate to the ledger `Accept` window by using the ledger's
right button, and then authorize the request by pressing both left and right buttons.

Note that if the ledger is not funded or does not have enough funds, we'll get an error message:

```text
*** Please sign subnet creation hash on the ledger device *** 
Error: insufficient funds: provided UTXOs need 1000000000 more units of asset "U8iRqJoiJm8xZHAacmvYyZVwqQx6uDNtQeP3CQ6fcgQk3JqnK"
```

For the success case, the Subnet id is going to be created, taking 1 AVAX from the ledger address, and a chain creation TX
is going to be asked to be signed.

```text
Subnet has been created with ID: 2UUCLbdGqawRDND7kHjwq3zXXMPdiycG2bkyuRzYMnuTSDr6db. Now creating blockchain...
*** Please sign blockchain creation hash on the ledger device *** 
```

On the ledger a `Sign Hash` window is going to be active. Navigate to the ledger `Accept` window by using the ledger's
right button, and then authorize the request by pressing both left and right buttons.

After that, the blockchain is going to be created, taking 1 AVAX from the ledger address, and a summary window
for the deployment is going to be shown:

```text
+--------------------+------------------------------------------------------------------------------------+
| DEPLOYMENT RESULTS |                                                                                    |
+--------------------+------------------------------------------------------------------------------------+
| Chain Name         | testsubnet                                                                         |
+--------------------+------------------------------------------------------------------------------------+
| Subnet ID          | 2UUCLbdGqawRDND7kHjwq3zXXMPdiycG2bkyuRzYMnuTSDr6db                                 |
+--------------------+------------------------------------------------------------------------------------+
| VM ID              | rW1esjm6gy4BtGvxKMpHB2M28MJGFNsqHRY9AmnchdcgeB3ii                                  |
+--------------------+------------------------------------------------------------------------------------+
| Blockchain ID      | wNoEemzDEr54Zy3iNn66yjUxXmZS9LKsZYSUciL89274mHsjG                                  |
+--------------------+------------------------------------------------------------------------------------+
| RPC URL            | http://127.0.0.1:9650/ext/bc/wNoEemzDEr54Zy3iNn66yjUxXmZS9LKsZYSUciL89274mHsjG/rpc |
+--------------------+------------------------------------------------------------------------------------+
| P-Chain TXID       | wNoEemzDEr54Zy3iNn66yjUxXmZS9LKsZYSUciL89274mHsjG                                  |
+--------------------+------------------------------------------------------------------------------------+
```

In this case, the ledger address is the control key, so there is going to be no control key authorization error,
but in general, if the control key is specified manually and is not controlled by the ledger, an error is going to occur:

```text
Subnet has been created with ID: 2UUCLbdGqawRDND7kHjwq3zXXMPdiycG2bkyuRzYMnuTSDr6db. Now creating blockchain...
Error: wallet does not contain subnet auth keys
exit status 1
```

You is going to see more about this on [multisig deploy tutorial](./multisig-deploy).

Well done. You have just created your own Subnet with your own Subnet-EVM running on `Mainnet`.

To get your new Subnet information, visit [Avalanche Explorer](https://subnets.avax.network/). The search works by P-Chain TXID,
so in this example, enter `wNoEemzDEr54Zy3iNn66yjUxXmZS9LKsZYSUciL89274mHsjG` into the search box and
you should see a confirmation on your shiny new blockchain TX.

Also, the Subnet id can be used in the search `2UUCLbdGqawRDND7kHjwq3zXXMPdiycG2bkyuRzYMnuTSDr6db`, to get information on
the associated Subnet id TX.

## Add a Validator

:::info

Adding a validator on a Subnet requires that the node is already a validator on the primary network, which means that your node has **fully bootstrapped**.

See [here](../nodes/validate/add-a-validator.md#add-a-validator-with-avalanche-wallet) on how to become a validator.

:::

This new Subnet is cool - but it doesn't have any dedicated validators yet. Let's add one by running the `addValidator` command and adding the name of our Subnet. To be clear, this does _not start or run_ a validator, it only whitelists the node as a recognized validator on the Subnet.

```bash
avalanche subnet addValidator testsubnet
```

First choose `Mainnet` as the network in which we want to add the Subnet validator.

```text
Use the arrow keys to navigate: ↓ ↑ → ← 
? Choose a network to add validator to.: 
  ▸ Fuji
    Mainnet
```

As this operation involves a new [transaction](../apis/avalanchego/apis/p-chain.md#platformaddsubnetvalidator),
we need some address to authorize the Subnet operation.
As there is only one control key in the Subnet, that one is going to be expected to be used for signing.
That address is going to also pay the add Subnet validator TX fee of 0.001 AVAX.

```text
Your subnet auth keys for add validator tx creation: [P-avax1ucykh6ls8thqpuwhg3vp8vvu6spg5e8tp8a25j]
```

Also, as `Mainnet` is being used here, the tool assumes that the first ledger address is going to be used as signing address.
So, it is expected that the connected ledger has the Subnet control key as its first address.

Now we need the **NodeID** of our new validator from the very beginning of this tutorial. For best results make sure the validator is running and synced.

```text
Next, we need the NodeID of the validator you want to whitelist.

Check https://docs.avax.network/apis/avalanchego/apis/info#infogetnodeid for instructions about how to query the NodeID from your node
(Edit host IP address and port to match your deployment, if needed).
✔ What is the NodeID of the validator you'd like to whitelist?: NodeID-7Xhw2mDxuDS44j42TCB6U5579esbSt3Lg█
```

(this ID is intentionally modified)

We'll select 30 as the stake weight. The structure is a bit described at [addSubnetValidator](../apis/avalanchego/apis/p-chain.md#platformaddsubnetvalidator) under the `weight` section.

```text
Use the arrow keys to navigate: ↓ ↑ → ←
? What stake weight would you like to assign to the validator?:
    Default (20)
  ▸ Custom
```

```text
✔ What stake weight would you like to assign to the validator?: 30
```

We then need to specify when the validator is going to start validating. The time must be in the future. Custom is going to require to enter a specific date in 'YYYY-MM-DD HH:MM:SS' format. Let's take the default this time:

```text
Use the arrow keys to navigate: ↓ ↑ → ←
? Start time:
  ▸ Start in one minute
    Custom
```

:::warning

If the `join` command is not successfully completed before this time elapses and the validator's stake weight is >20% of the Subnet, the Subnet may have down time.

:::

Finally, specify how long it is going to be validating:

```text
✔ Start in one minute
Use the arrow keys to navigate: ↓ ↑ → ←
? How long should your validator validate for?:
  ▸ Until primary network validator expires
    Custom
```

If we choose `Custom` here, we'll have to enter a **duration**, which is a time span expressed in hours. For example, we could say `200 days = 24 \* 200 = 4800h`

```text
✔ How long should this validator be validating? Enter a duration, e.g. 8760h: 4800h
```

The user is shown an actual date of when that is now:

```text
? Your validator is going to finish staking by 2023-06-10 13:07:58:
  ▸ Yes
    No
```

Confirm if correct. At this point the prompt series is complete and the transaction is attempted:

```text
NodeID: NodeID-7Xhw2mDxuDS44j42TCB6U5579esbSt3Lg
Network: Mainnet
Start time: 2022-11-22 13:07:58
End time: 2023-06-10 13:07:58
Weight: 30
Inputs complete, issuing transaction to add the provided validator information...
```

Next we is going to be asked for ledger authorization:

```text
*** Please provide extended public key on the ledger device ***
```

On the ledger a `Provide Extended Public Key` window is going to be active. Navigate to the ledger `Accept` window by using the ledger's
right button, and then authorize the request by pressing both left and right buttons.

Ledger address is going to be shown:

```text
Ledger address: P-avax1ucykh6ls8thqpuwhg3vp8vvu6spg5e8tp8a25j
```

At this point, if the ledger address is not the control key for the Subnet, we is going to get an error:

```text
Error: wallet does not contain subnet auth keys
exit status 1
```

If the ledger has not enough funds, the following error message is going to be seen after that.

```text
*** Please sign subnet creation hash on the ledger device *** 
Error: insufficient funds: provided UTXOs need 1000000 more units of asset "U8iRqJoiJm8xZHAacmvYyZVwqQx6uDNtQeP3CQ6fcgQk3JqnK"
```

Otherwise, a request for signing the TX is going to be done in both the CLI and the ledger:

```text
*** Please sign add validator hash on the ledger device ***
```

On the ledger a `Sign Hash` window is going to be active. Navigate to the ledger `Accept` window by using the ledger's
right button, and then authorize the request by pressing both left and right buttons.

This might take a couple of seconds, and is going to print, if successful:

```text
Transaction successful, transaction ID: r3tJ4Wr2CWA8AaticmFrKdKgAs5AhW2wwWTaQHRBZKwJhsXzb
```

This means the node has now been added as validator to the given Subnet on `Mainnet`!

You can get the P-Chain TXID information on [Avalanche Explorer](https://subnets.avax.network/)

## Join a Subnet

You might already have a running validator which you want to add to a specific Subnet. For this we run the `join` command.
This is a bit of a special command. The `join` command is going to either just _print the required instructions_ for your already running node or is going to attempt at configuring a config file the user provides.

```bash
avalanche subnet join testsubnet
```

First ask for network for which we are joining the validator. Choose `Mainnet`:

```text
Use the arrow keys to navigate: ↓ ↑ → ←
? Choose a network to validate on (this command only supports public networks):
  ▸ Fuji
    Mainnet
```

In the [deploy the SUBNET](#deploy-the-subnet) section, we saw that a Subnet is permissioned via a set of keys. Therefore not any node can be added as validator to the Subnet. A holder of a control key _must_ call [SUBNET addValidator](../apis/avalanchego/apis/p-chain.md#platformaddsubnetvalidator) first to allow the node to validate the Subnet. So the tool allows the user now to verify if the node has already been permissioned ("whitelisted") to be a validator for this Subnet (by calling an API in the background).

```text
Would you like to check if your node is allowed to join this subnet?
If not, the subnet's control key holder must call avalanche subnet
addValidator with your NodeID.
Use the arrow keys to navigate: ↓ ↑ → ←
? Check whitelist?:
    Yes
  ▸ No
```

The default is `Yes` but we'll choose `No` here to speed up things, assuming the node is already whitelisted.

There are now two choices possible: automatic and Manual configuration. As mentioned earlier, "Automatic" is going to attempt at editing a config file and setting up your plugin directory, while "Manual" is going to just print the required config to the screen. Let's see what "Automatic" does:

```text
✔ Automatic
✔ Path to your existing config file (or where it is going to be generated): config.json
```

We need to provide a path to a config file. If this command were to be run on the box where your validator is running, then you could point this to the actually used config file, for example `/etc/avalanchego/config.json` - just make sure the tool has **write** access to the file. Or you could just copy the file later. In any case, the tool is going to either try to edit the existing file specified by the given path, or create a new file. Again, write permissions are required.

Next, we need to provide the plugin directory. We described VMs at the beginning of this tutorial [Virtual Machine](#virtual-machine). Each VM runs its own plugin, therefore AvalancheGo needs to be able to access the correspondent plugin binary. As this is the `join` command, which doesn't know yet about the plugin, we need to provide the directory where the plugin is installed. Make sure to provide the location for your case:

```text
✔ Path to your avalanchego plugin dir (likely avalanchego/build/plugins): /home/user/go/src/github.com/ava-labs/avalanchego/build/plugins
```

The tool doesn't know where exactly it's located so it requires the full path. With the path given, it is going to copy the VM binary to the provided location:

```text
✔ Path to your avalanchego plugin dir (likely avalanchego/build/plugins): /home/user/go/src/github.com/ava-labs/avalanchego/build/plugins█
VM binary written to /home/user/go/src/github.com/ava-labs/avalanchego/build/plugins/tGBrMADESojmu5Et9CpbGCrmVf9fiAJtZM5ZJ3YVDj5JTu2qw
This is going to edit your existing config file. This edit is nondestructive,
but it's always good to have a backup.
Use the arrow keys to navigate: ↓ ↑ → ←
? Proceed?:
  ▸ Yes
    No
```

Hitting `Yes` is going to attempt at writing the config file:

```text
✔ Yes
The config file has been edited. To use it, make sure to start the node with the '--config-file' option, e.g.

./build/avalanchego --config-file config.json

(using your binary location). The node has to be restarted for the changes to take effect.
```

It is **required to restart the node**.

If we would have chosen "Manual" instead, the tool is going to just print _instructions_. The user is going to have to follow these instructions and apply them to the node. Note that the IDs for the VM and Subnets is going to be different in your case.

```text
✔ Manual

To setup your node, you must do two things:

1. Add your VM binary to your node's plugin directory
2. Update your node config to start validating the subnet

To add the VM to your plugin directory, copy or scp from /tmp/tGBrMADESojmu5Et9CpbGCrmVf9fiAJtZM5ZJ3YVDj5JTu2qw

If you installed avalanchego manually, your plugin directory is likely
avalanchego/build/plugins.

If you start your node from the command line WITHOUT a config file (e.g. via command
line or systemd script), add the following flag to your node's startup command:

--whitelisted-subnets=2b175hLJhGdj3CzgXENso9CmwMgejaCQXhMFzBsm8hXbH2MF7H
(if the node already has a whitelisted-subnets config, append the new value by
comma-separating it).

For example:
./build/avalanchego --network-id=Mainnet --whitelisted-subnets=2b175hLJhGdj3CzgXENso9CmwMgejaCQXhMFzBsm8hXbH2MF7H

If you start the node via a JSON config file, add this to your config file:
whitelisted-subnets: 2b175hLJhGdj3CzgXENso9CmwMgejaCQXhMFzBsm8hXbH2MF7H

TIP: Try this command with the --avalanchego-config flag pointing to your config file,
this tool is going to try to update the file automatically (make sure it can write to it).

After you update your config, you is going to need to restart your node for the changes to
take effect.
```

## Subnet Export

This tool is most useful on the machine where a validator is or is going to be running. In order to allow a VM to run on a different machine, the configuration can be exported. We just need to provide a path to where to export the data:

```bash
avalanche subnet export testsubnet
✔ Enter file path to write export data to: /tmp/testsubnet-export.dat
```

The file is in text format and it should not be tampered with. It can then be used to import the configuration on a different machine.

## Subnet Import

To import a VM specification exported in the previous section, just issue the `import` command with the path to the file after having copied the file over:

```bash
avalanche subnet import /tmp/testsubnet-export.dat
Subnet imported successfully
```

After this the whole Subnet configuration should be available on the target machine:

```text
avalanche subnet list
+---------------+---------------+----------+-----------+----------+
|    SUBNET     |     CHAIN     | CHAIN ID |   TYPE    | DEPLOYED |
+---------------+---------------+----------+-----------+----------+
| testsubnet    | testsubnet    |     3333 | SubnetEVM | No       |
+---------------+---------------+----------+-----------+----------+
```

## Appendix

### Connect with MetaMask

To connect MetaMask with your blockchain on the new Subnet running on your local computer, you can add a new network on MetaMask with the following values:

```text
- Network Name: testsubnet
- RPC URL: http://127.0.0.1:9650/ext/bc/2XDnKyAEr1RhhWpTpMXqrjeejN23vETmDykVzkb4PrU1fQjewh/rpc
- ChainID: 3333
- Symbol: TST
```

:::note

Unless your Subnet has been deployed on other nodes, you is going to not be able to use other nodes, including the public API server `https://api.avax.network/`, to connect to MetaMask.

If you want to open up this node for others to access your Subnet, you should set it up properly with `https//node-ip-address` instead of `http://127.0.0.1:9650`, however, it is out of scope for this tutorial on how to do that.

:::
